import{A as E,a as _,t as B}from"./api.4a23552d.js";import{J as S}from"./JsonEditor.5c307516.js";import{I as J}from"./plus.150cb170.js";import{_ as V,r as O,b as u,o as c,c as l,a as t,d as v,e as m,h as C,k as d,F as A,y as N,w as R,v as j,E as D,n as F,t as g,g as y}from"./index.3459ee34.js";import{N as M}from"./N-Button.3dce5523.js";const U={createdBy:"$uid"},I={name:"ConfigEditor",components:{NButton:M,JsonEditor:S,IconAdd:J},props:{config:{type:Object,required:!0},disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["saved","canceled"],setup(e){const s=O(e.config),o=JSON.parse(JSON.stringify(e.config));return{tempConfig:s,initialConfig:o}},computed:{hasUnAuthenticatedRole(){return this.tempConfig.find(e=>!e.user)},hasAuthenticatedRole(){return this.tempConfig.find(e=>e.user===!0)},configChanged(){try{let e=JSON.stringify(this.tempConfig),s=JSON.stringify(this.initialConfig);return console.log("check",e,s),e!==s}catch{return!0}}},methods:{getUserMode(e){return e.user&&e.user.role!==void 0?"role":e.user===!0?"authed":"un_authed"},removeRole(e){this.tempConfig.splice(e,1)},addRole(){this.hasUnAuthenticatedRole?this.hasAuthenticatedRole?this.tempConfig.splice(0,0,{user:{role:""},create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!0,create:!1,read:!1,delete:!1,update:!1}):this.tempConfig.splice(0,0,{user:!1,create:!1,read:!1,delete:!1,update:!1})},getFilterMode(e){return e?e===!0?"all":JSON.stringify(U)===JSON.stringify(e)?"own":"custom":"none"},onUserModeChanged(e,s){const o=s.target.value;this.getUserMode(e)!==o&&(o==="role"?e.user={role:""}:e.user=o==="authed")},onFilterChanged(e,s,o){const h=e[s],r=o.target.value;h!==r&&(r==="none"?e[s]=!1:r==="all"?e[s]=!0:r==="own"?e[s]=U:e[s]={})},discardChanges(){this.tempConfig.splice(0,this.tempConfig.length),this.tempConfig.push(...this.initialConfig)},saveChanges(){this.$emit("save",this.tempConfig)}}},L={class:"ConfigEditor"},T={class:"flex pb-4 gap-4 items-center"},q=y(" Add Role "),z=y(" Discard changes "),Y=t("span",{class:"ml-auto"},null,-1),Z=y(" Save Changes "),$={class:"user w-full flex gap-4 items-center mb-2"},G=["value","onChange"],H=t("option",{value:"role"},"users with role",-1),K=t("option",{value:"authed"},"authenticated users",-1),P=t("option",{value:"un_authed"},"un-authenticated users",-1),Q=[H,K,P],W=["onUpdate:modelValue"],X=["onClick"],ee={class:"access flex flex-col justify-center space-y-2 px-4"},te={class:"create flex items-center gap-1 w-full"},se=["id","onUpdate:modelValue","disabled"],ne=["for"],oe=["value","disabled","onChange"],ae={value:"all"},ie={value:"own"},ce={value:"custom"},re={value:"none"},le=t("br",null,null,-1);function de(e,s,o,h,r,a){const b=u("IconAdd"),f=u("NButton"),k=u("JsonEditor");return c(),l("div",L,[t("div",T,[v(f,{class:"primary",disabled:o.loading,onClick:a.addRole},{default:m(()=>[v(b),q]),_:1},8,["disabled","onClick"]),a.configChanged?(c(),C(f,{key:0,disabled:o.loading,class:"",onClick:a.discardChanges},{default:m(()=>[z]),_:1},8,["disabled","onClick"])):d("",!0),Y,a.configChanged?(c(),C(f,{key:1,loading:o.loading,class:"success",onClick:a.saveChanges},{default:m(()=>[Z]),_:1},8,["loading","onClick"])):d("",!0)]),(c(!0),l(A,null,N(h.tempConfig,(i,p)=>(c(),l("div",{key:p,class:"config mb-4 border px-2 py-4 card"},[t("div",$,[t("select",{value:a.getUserMode(i),onChange:n=>a.onUserModeChanged(i,n)},Q,40,G),a.getUserMode(i)==="role"?R((c(),l("input",{key:0,"onUpdate:modelValue":n=>i.user.role=n,type:"text"},null,8,W)),[[j,i.user.role]]):d("",!0),t("button",{class:"text-white ml-auto bg-red-400 px-2 py-1 rounded",onClick:n=>a.removeRole(p)}," Remove Role ",8,X)]),t("div",ee,[t("div",te,[R(t("input",{id:"create_"+p,"onUpdate:modelValue":n=>i.create=n,name:"create",type:"checkbox",disabled:o.loading,textContent:"can create"},null,8,se),[[D,i.create]]),t("label",{for:"create_"+p},"can create documents",8,ne)]),(c(),l(A,null,N(["read","update","delete"],n=>t("div",{key:n,class:F(n)},[t("select",{value:a.getFilterMode(i[n]),class:"w-full",disabled:o.loading,onChange:x=>a.onFilterChanged(i,n,x)},[t("option",ae,"can "+g(n)+" all documents",1),t("option",ie,"can "+g(n)+" documents created by him",1),t("option",ce,"can "+g(n)+" some documents",1),t("option",re,"can't "+g(n)+" any documents",1)],40,oe),a.getFilterMode(i[n])==="custom"?(c(),C(k,{key:0,modelValue:i[n],"onUpdate:modelValue":x=>i[n]=x},null,8,["modelValue","onUpdate:modelValue"])):d("",!0)],2)),64))]),le]))),128))])}var ue=V(I,[["render",de]]);const w={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24"},he=t("path",{d:"M12.63 2c5.53 0 10.01 4.5 10.01 10s-4.48 10-10.01 10c-3.51 0-6.58-1.82-8.37-4.57l1.58-1.25C7.25 18.47 9.76 20 12.64 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8C8.56 4 5.2 7.06 4.71 11h2.76l-3.74 3.73L0 11h2.69c.5-5.05 4.76-9 9.94-9m2.96 8.24c.5.01.91.41.91.92v4.61c0 .5-.41.92-.92.92h-5.53c-.51 0-.92-.42-.92-.92v-4.61c0-.51.41-.91.91-.92V9.23c0-1.53 1.25-2.77 2.77-2.77 1.53 0 2.78 1.24 2.78 2.77v1.01m-2.78-2.38c-.75 0-1.37.61-1.37 1.37v1.01h2.75V9.23c0-.76-.62-1.37-1.38-1.37Z"},null,-1),fe=[he];function _e(e,s){return c(),l("svg",w,fe)}w.width="24";w.height="24";w.viewBox="0 0 24 24";var ge={render:_e};const pe={name:"AccessConfig",components:{NButton:M,ConfigEditor:ue,IconReset:ge},beforeRouteUpdate(){this.fetchData()},data(){return{accessConfig:null,render_counter:1,loading:!1,fetching:!1}},computed:{api(){return E.AccessControl(this.project)},collection(){return this.$route.params.collection},project(){return this.$route.params.project}},watch:{"$route.params.project":{handler(e,s){e&&this.$router.push({name:"access",params:{project:e}})}}},mounted(){this.fetchData()},methods:{async fetchData(){this.fetching=!0;try{const{data:e}=await this.api.getAccessConfig(this.collection);this.accessConfig=e}catch(e){console.error(e)}finally{this.fetching=!1}},async resetConfig(){const{isConfirmed:e}=await _.fire({title:"Reset Config",text:"Are you sure?",cancelButtonText:"cancel",cancelButtonColor:"gray",confirmButtonText:"Yes, reset config",confirmButtonColor:"red",showCancelButton:!0,preConfirm:async s=>{if(!s)return s;_.showLoading(_.getConfirmButton());try{await this.api.resetConfig(this.collection),await this.fetchData(),this.render_counter++,_.close(),B("Config has been reset")}catch(o){console.error(o)}finally{_.hideLoading()}}})},async updateConfig(e){try{this.loading=!0,await this.api.updateConfig(this.collection,e),this.render_counter++,B("Saved Changes")}catch(s){console.error(s)}finally{this.loading=!1}}}},me={class:"AccessConfig"},Ce={class:"card mb-4"},ve={class:"flex header"},ye=y(" Access Config "),we={class:"pl-2 normal-case"},be=t("span",{class:"ml-auto"},null,-1),ke={key:1,class:"skeloading"};function xe(e,s,o,h,r,a){const b=u("IconReset"),f=u("NButton"),k=u("ConfigEditor");return c(),l("div",me,[t("div",Ce,[t("div",ve,[ye,t("span",we,g(a.collection),1),be,v(f,{class:"",onClick:a.resetConfig},{default:m(()=>[v(b)]),_:1},8,["onClick"])])]),r.fetching?d("",!0):(c(),C(k,{key:r.render_counter,config:r.accessConfig,loading:r.loading,onSave:a.updateConfig},null,8,["config","loading","onSave"])),r.fetching?(c(),l("div",ke)):d("",!0)])}var Ve=V(pe,[["render",xe]]);export{Ve as default};
