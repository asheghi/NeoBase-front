import{o as l,c as u,a as n,_ as v,b as _,d as p,k as b,f as k,F as x,x as D,h as w,m as N,r as y,p as S,e as j,g as $,t as B,n as F}from"./index.3088f20f.js";import{g as V,A as I,t as C}from"./api.4a23552d.js";import{J as M}from"./JsonEditor.d3c08173.js";import{J as U}from"./JsonInput.db2f6352.js";import{N as J}from"./N-Button.318009ac.js";const g={xmlns:"http://www.w3.org/2000/svg",class:"ionicon",viewBox:"0 0 512 512"},O=n("path",{d:"M448 256c0-106-86-192-192-192S64 150 64 256s86 192 192 192 192-86 192-192z",fill:"none",stroke:"currentColor","stroke-miterlimit":"10","stroke-width":"32"},null,-1),A=n("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M336 256H176"},null,-1),E=[O,A];function R(e,t){return l(),u("svg",g,E)}g.width="24";g.height="24";var K={render:R};const q={name:"DocumentField",components:{RemoveIcon:K},props:{fieldKey:{type:String,required:!0,default:""},fieldValue:{type:Object,required:!0}},emits:["update:modelValue"],data(){return{selected_type:null}},computed:{type(){const{selected_type:e}=this;if(e)return e;if(!String(this.fieldValue))return"text";const t=typeof this.fieldValue;if(console.log("typeof ",t),t==="boolean")return"boolean";if(t==="string"&&this.fieldValue.length===24&&this.fieldValue.endsWith("Z"))return"date-time";if(t==="object"){if(Array.isArray(this.fieldValue))return"array";if(this.fieldValue)return"object"}return isNaN(this.fieldValue)?"text":"number"}}},z={class:"Field"},L={class:"key"},T=n("label",{for:"key"},"Field",-1),H=["value"],W=n("div",{class:"dotted-line"},null,-1),Z=n("div",{class:"equal"},"=",-1),G={class:"type"},P=n("label",{for:"type"},"Type",-1),Q=["value"],X=k('<option value="text">text</option><option value="number">number</option><option value="boolean">boolean</option><option value="date-time">date-time</option><option value="array">array</option><option value="map">map</option>',6),Y=[X],ee={class:"value"},te=n("label",{for:"value"},"Value",-1),oe=n("br",null,null,-1),ne=["value"],ie=["value"],de=["value"],ae=n("option",{value:!0,textContent:"true"},null,-1),le=n("option",{value:!1,textContent:"false"},null,-1),se=[ae,le],ue=["value"],re={key:0,class:"remove-icon"};function ce(e,t,d,r,s,i){const a=_("RemoveIcon");return l(),u("div",z,[n("div",L,[T,n("input",{id:"key",name:"key",value:d.fieldKey,placeholder:"key",onChange:t[0]||(t[0]=o=>e.$emit("update:field-key",o.target.value,d.fieldKey))},null,40,H),W]),Z,n("div",G,[P,n("select",{id:"type",value:i.type,onChange:t[1]||(t[1]=o=>s.selected_type=o.target.value)},Y,40,Q)]),n("div",ee,[te,oe,i.type==="number"?(l(),u("input",{key:0,id:"value",type:"number",value:d.fieldValue,name:"value",placeholder:"value",onChange:t[2]||(t[2]=o=>e.$emit("update:field-value",+o.target.value))},null,40,ne)):i.type==="text"?(l(),u("input",{key:1,id:"value",value:d.fieldValue,name:"value",placeholder:"value",onChange:t[3]||(t[3]=o=>e.$emit("update:field-value",o.target.value))},null,40,ie)):i.type==="boolean"?(l(),u("select",{key:2,id:"type",value:d.fieldValue,onChange:t[4]||(t[4]=o=>e.$emit("update:field-value",Boolean(o.target.value)))},se,40,de)):(l(),u("textarea",{key:3,id:"type",value:d.fieldValue,onChange:t[5]||(t[5]=o=>e.$emit("update:field-value",JSON.parse(o.target.value)))},null,40,ue))]),d.fieldKey?(l(),u("button",re,[p(a,{class:"icon",width:"24",height:"24",onClick:t[6]||(t[6]=o=>e.$emit("remove"))})])):b("",!0)])}var me=v(q,[["render",ce]]);const f=V("document-editor"),he={name:"DocumentEditor",components:{DocumentField:me},props:{modelValue:{default:{}}},data(){return{document:this.modelValue||{"":""},render_counter:1}},watch:{render_counter(){Object.keys(this.document).find(e=>e==="")||(this.document[""]="")}},mounted(){this.render_counter++},methods:{onKeyChange(e,t){f.debug(`on key changed, new:${e}, old:${t}`),this.document[String(e)]=this.document[t],delete this.document[t],f.debug("after: ",this.document),this.render_counter++,this.fireUpdate()},onValueChanged(e,t){f.debug("onValueChanged",e,typeof e,t,typeof t),this.document[String(e)]=t,this.render_counter++,this.fireUpdate()},fireUpdate(){const e={...this.document};delete e[""],console.log("check",e),this.$emit("update:modelValue",e)},removeField(e){!e||(delete this.document[e],this.fireUpdate())}}},_e={class:"DocumentEditor"};function fe(e,t,d,r,s,i){const a=_("DocumentField");return l(),u("div",_e,[(l(!0),u(x,null,D(Object.keys(s.document),(o,c)=>(l(),w(a,{key:c,"field-key":String(o),"field-value":s.document[o],"onUpdate:fieldKey":i.onKeyChange,"onUpdate:fieldValue":m=>i.onValueChanged(o,m),onRemove:m=>i.removeField(o)},null,8,["field-key","field-value","onUpdate:fieldKey","onUpdate:fieldValue","onRemove"]))),128))])}var pe=v(he,[["render",fe]]);const h=V("create-document"),ve={name:"CreateDocument",components:{NButton:J,JsonInput:U,JsonEditor:M,DocumentEditor:pe},props:{doc:{type:Object,default:()=>({foo:"bar"})},hideId:{type:Boolean,default:!1,required:!1}},emits:["created","cancel"],setup(e){const{project:t,collection:d}=N().params,r=y("json"),s=S(()=>r.value==="json"?"editor":"json"),i=()=>{r.value=s.value},a={...e.doc},o=e.doc._id?String(e.doc._id):null,c=o?"edit":"create";delete a._id,delete a.createdAt,delete a.updatedAt,delete a.createdBy,delete a.__v;const m=y(a);return{documentId:o,mode:c,document:m,project:t,collection:d,api:I.Documents(t,d),currentMode:r,alternateMode:s,toggleMode:i}},data(){return{loading:!1}},computed:{document_id(){return this.mode==="create"?"new ObjectId()":this.doc._id}},methods:{async createDocument(){if(!this.document){h.error("this.document is not defined!",this.document);return}""in this.document&&delete this.document[""];try{this.loading=!0;const{data:e}=await this.api.create(this.document);this.$emit("created",e),C("created new document")}catch(e){h.error(e)}finally{this.loading=!1}},async updateDocument(){if(!this.document){h.error("this.document is not defined!",this.document);return}try{""in this.document&&delete this.document[""];const e={_id:this.document_id};this.loading=!0,await this.api.updateOne(e,this.document),this.$emit("updated",this.document_id),C("updated document")}catch(e){h.error(e)}finally{this.loading=!1}},onCancel(){this.$emit("cancel",!0)},toggleAlternateMode(){this.currentMode=this.alternateMode},onSave(){this.mode==="edit"?this.updateDocument():this.createDocument()},updatedJson(e){console.log("check arg",e)}}},ge={class:"buttons"};function ye(e,t,d,r,s,i){const a=_("JsonInput"),o=_("NButton");return l(),u("div",{class:F(["NewDocument","mode-"+r.currentMode])},[p(a,{modelValue:r.document,"onUpdate:modelValue":t[0]||(t[0]=c=>r.document=c)},null,8,["modelValue"]),n("div",ge,[n("button",{class:"text-primary dark:text-white",onClick:t[1]||(t[1]=(...c)=>i.onCancel&&i.onCancel(...c)),textContent:"cancel"}),p(o,{loading:s.loading,class:"primary",onClick:i.onSave},{default:j(()=>[$(B(s.loading?"Saving":"Save"),1)]),_:1},8,["loading","onClick"])])],2)}var De=v(ve,[["render",ye]]);export{De as C};
